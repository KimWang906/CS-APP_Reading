# CS:APP

## The process of running a program(Hardware)

### Bus

: 시스템 내를 관통하는 전기적 배선군, 컴포넌트들 간에 바이트 정보들을 전송합니다.  
버스는 일반적으로 **워드(word)** 라고 하는 고정 크기의 바이트 단위로 데이터를 전송하도록 설계되어 있습니다.  
워드의 일반적인 크기는 **4byte** 또는 **8byte**입니다.

### I/O Device

: **입출력 장치**는 시스템과 외부세계와의 연결을 담당합니다.  
  
ex) 이 시스템은 4개의 입출력 장치를 가지고 있습니다.
: 키보드, 마우스, 디스플레이(모니터), 저장장치(디스크, 처음에 실행가능 파일인 hello 프로그램은 디스크에 있습니다)  
  
각 입출력 장치는 [버스](#bus)와 컨트롤러나 어댑터를 통해 연결됩니다.
이 두 장치의 차이는 **패키징(packaging)**에 있습니다. 컨트롤러는 디바이스 자체가 칩셋이거나 시스템의 인쇄기판(종종 머더보드라고 부릅니다)에 장착됩니다. 어댑터는 머더보드의 슬롯에 장착되는 카드입니다.  
이들 각각의 목적은 입출력 버스와 입출력 장치들 간에 **정보를 주고 받도록 하는 일**을 합니다.

### Main Memory

: **메인 메모리**는 프로세서가 프로그램을 실행하는 동안 데이터와 프로그램을 모두 저장하는 임시 저장장치입니다. 물리적으로 메인 메모리는 [DRAM(Dynamic Random Access Memory)](https://en.wikipedia.org/wiki/Dynamic_random-access_memory) 칩들로 구성되어 있습니다. 논리적으로 **메모리는 연속적인 바이트들의 배열**로, 각각 0부터 시작해서 고유의 주소(**배열의 인덱스**)를 가지고 있습니다. 일반적으로 한 개의 프로그램을 구성하는 각 기계어 명령(인스트럭션)은 다양한 바이트 크기를 갖습니다.  
  
C 프로그램 변수들의 데이터 크기는 데이터 형에 따라 다릅니다.  
예를 들면, 리눅스가 동작하는 `x86-64` 컴퓨터에서 `short` 타입의 데이터는 2바이트를, `int`, `float`은 4바이트, `long`과 `double`은 8바이트를 필요로 합니다.

### Processer

: **주처리장치(CPU)** 또는 간단히 프로세서는 메인 메모리에 저장된 명령(인스트럭션)들을 해독(실행)하는 엔진입니다. 프로세서의 중심에는 워드 크기의 저장장치(또는 레지스터)인 [프로그램 카운터(PC)](https://en.wikipedia.org/wiki/Program_counter)가 있습니다. 어느 한순간에 `PC`는 메인 메모리의 기계어 명령(인스트럭션)을 가리킵니다.  
  
시스템에 전원이 공급되는 순간부터 전원이 끊어질 때 까지 프로세서는 프로그램 카운터가 가리키는 곳의 명령(인스트럭션)을 **반복적으로 실행**하고 `PC`값이 다음 명령(인스트럭션)의 위치를 가리키도록 **업데이트**합니다.  
  
이와 같은 몇 개의 단순한 동작만이 있을 뿐이며, 이들은 `메인 메모리`, `레지스터 파일`, `수식/논리 처리기(ALU)` 주위를 순환합니다. 레지스터 파일은 **각각 고유의 이름을 갖는 워드 크기의 레지스터 집합**으로 구성되어 있습니다. `ALU`는 **새 데이터와 주소 값을 계산**합니다.  
  
다음은 명령(인스트럭션)의 요청에 의해 `CPU`가 실행하는 단순한 작업의 예입니다.  

* **적재(Load)**: **메인 메모리에서 레지스터**에 한 바이트 또는 워드를 **이전 값에 덮어쓰는 방식**으로 복사합니다.
* **저장(Store)**: **레지스터에서 메인 메모리**로 한 바이트 또는 워드를 **이전 값을 덮어쓰는 방식**으로 복사합니다.
* **작업(Operate)**: 두 레지스터의 값을 `ALU`로 복사하고 **두 개의 워드로 수식연산을 수행**한 뒤, 결과를 덮어쓰기 방식으로 레지스터에 저장합니다.
* **점프(Jump)**: 명령(인스트럭션) **자신으로부터 한 개의 워드를 추출**하고, 이것을 **PC에 덮어쓰기 방식**으로 복사합니다.

## The process of running a program(Software)

### hello 프로그램의 실행

처음에 쉘 프로그램은 자신의 명령(인스트럭션)을 실행하면서 사용자가 명령을 입력하기를 기다립니다.  
`\hello`를 입력하면 쉘 프로그램은 **각각의 문자를 레지스터에 읽어들인 후, 메모리에 저장**합니다.  
키보드에서 엔터(Enter) 키를 누르면 쉘은 명령 입력을 끝마쳤다는 것을 알게 됩니다. 그러면 쉘은 파일 내의 코드와 데이터를 복사하는 일련의 명령(인스트럭션)을 실행하여 실행파일 hello를 디스크에서 메인 메모리로 로딩합니다. 데이터 부분은 최종적으로 출력되는 문자 스트링인 `"hello, world\n"`을 포함합니다. [직접 메모리 접근(DMA)](https://en.wikipedia.org/wiki/Direct_memory_access)이라고 알려진 기법을 이용하여 **데이터는 프로세서를 거치지 않고 디스크에서 메인 메모리로 직접 이동**합니다.  
  
우선 hello 목적파일의 코드와 데이터가 메모리에 적재된 후, 프로세서는 hello 프로그램의 main 루틴의 기계어 명령(인스트럭션)을 실행하기 시작합니다. 이 명령(인스트럭션)들은 `"hello, world\n"` **스트링을 메모리로부터 레지스터 파일로 복사하고, 거기로부터 디스플레이 장치(모니터)로 전송**하여 화면에 글자들이 표시됩니다.

### CPU 캐시는 내일 자세히 정리 예정..
